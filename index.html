<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Step-Up Challenge</title>
</head>
<body>
    <iframe id="step-up-iframe" name="step-up-iframe" style="display: none;"></iframe>
    <form id="step-up-form" method="POST" target="step-up-iframe">
        <input type="hidden" name="JWT" value="">
        <input type="hidden" name="MD" value="">
    </form>

    <script>
        window.receiveStepUpConfig = function(config) {
            const form = document.getElementById('step-up-form');
            const iframe = document.getElementById('step-up-iframe');
            
            // Set form attributes
            form.action = config.stepUpUrl;
            
            // Set iframe dimensions
            iframe.style.display = 'block';
            iframe.style.width = config.width + (typeof config.width === 'number' ? 'px' : '');
            iframe.style.height = config.height + (typeof config.height === 'number' ? 'px' : '');
            
            // Set form inputs
            form.querySelector('input[name="JWT"]').value = config.pareq;
            form.querySelector('input[name="MD"]').value = config.accessToken;
            
            // Submit the form
            form.submit();
        }

        // Listen for step-up completion
        window.addEventListener("message", function(event) {
            if (event.origin === "https://centinelapistag.cardinalcommerce.com") {
                if (typeof StepUpHandler !== 'undefined' && StepUpHandler && typeof StepUpHandler.postMessage === 'function') {
                    console.log('StepUpHandler is available, sending otp challenge result');
                    StepUpHandler.postMessage(JSON.stringify({ data: event.data }));
                } else {
                    console.warn('StepUpHandler not available');
                }
            }
        }, false);
    </script>
</body>
</html>